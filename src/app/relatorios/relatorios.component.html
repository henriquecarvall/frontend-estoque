<div class="relatorios-container">
  <h2>üìä Relat√≥rios do Sistema</h2>

  <!-- Filtros -->
  <div class="filtros-section">
    <h3>üîç Filtros</h3>
    <div class="filtros-grid">
      <div class="filtro-group">
        <label for="dataInicio">Data In√≠cio:</label>
        <input type="date" id="dataInicio" [(ngModel)]="filtroDataInicio" (change)="aplicarFiltros()">
      </div>

      <div class="filtro-group">
        <label for="dataFim">Data Fim:</label>
        <input type="date" id="dataFim" [(ngModel)]="filtroDataFim" (change)="aplicarFiltros()">
      </div>

      <div class="filtro-group">
        <label for="categoria">Categoria:</label>
        <select id="categoria" [(ngModel)]="filtroCategoria" (change)="aplicarFiltros()">
          <option value="">Todas as categorias</option>
          <option *ngFor="let cat of categorias" [value]="cat">{{cat}}</option>
        </select>
      </div>

      <button class="btn-limpar" (click)="limparFiltros()">üîÑ Limpar Filtros</button>
    </div>
  </div>

  <div class="loading" *ngIf="carregando">
    üìà Carregando dados do sistema...
  </div>

  <div *ngIf="!carregando" class="dashboard">
    <!-- Cards de Estat√≠sticas -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">üì¶</div>
        <div class="stat-info">
          <h3>Total de Produtos</h3>
          <span class="stat-value">{{ produtosFiltrados.length }}</span>
          <small class="stat-desc">{{ filtroAtivo ? 'Filtrado' : 'Total no sistema' }}</small>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">üí∞</div>
        <div class="stat-info">
          <h3>Valor Total em Estoque</h3>
          <span class="stat-value">R$ {{ valorTotalEstoque.toFixed(2) }}</span>
          <small class="stat-desc">Valor total do estoque</small>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">‚ö†Ô∏è</div>
        <div class="stat-info">
          <h3>Estoque Baixo</h3>
          <span class="stat-value">{{ produtosEstoqueBaixo.length }}</span>
          <small class="stat-desc">< 10 unidades</small>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">üìà</div>
        <div class="stat-info">
          <h3>Valor M√©dio</h3>
          <span class="stat-value">R$ {{ valorMedioProduto.toFixed(2) }}</span>
          <small class="stat-desc">Por produto</small>
        </div>
      </div>
    </div>

    <!-- Produtos Mais Caros -->
    <div class="top-produtos-section">
      <h3>üèÜ Top 5 Produtos Mais Valiosos</h3>
      <div class="top-produtos-grid">
        <div *ngFor="let produto of topProdutosValiosos; let i = index" class="top-produto-card">
          <div class="rank">{{ i + 1 }}</div>
          <div class="produto-info">
            <strong>{{ produto.nome }}</strong>
            <span class="categoria">{{ produto.categoria }}</span>
          </div>
          <div class="produto-valor">
            <div class="valor">R$ {{ (produto.precoUnitario || 0).toFixed(2) }}</div>
            <div class="estoque">{{ produto.quantidadeEstoque || 0 }} unidades</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Lista de Produtos com Estoque Baixo -->
    <div class="estoque-baixo-section" *ngIf="produtosEstoqueBaixo.length > 0">
      <h3>‚ö†Ô∏è Produtos com Estoque Baixo (< 10 unidades)</h3>
      <table class="tabela-produtos">
        <thead>
        <tr>
          <th>C√≥digo</th>
          <th>Nome</th>
          <th>Estoque</th>
          <th>Pre√ßo</th>
          <th>Valor Total</th>
          <th>Categoria</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let produto of produtosEstoqueBaixo">
          <td>{{ produto.codigo }}</td>
          <td>{{ produto.nome }}</td>
          <td class="estoque-baixo">{{ produto.quantidadeEstoque || 0 }}</td>
          <td>R$ {{ (produto.precoUnitario || 0).toFixed(2) }}</td>
          <td>R$ {{ ((produto.precoUnitario || 0) * (produto.quantidadeEstoque || 0)).toFixed(2) }}</td>
          <td>{{ produto.categoria }}</td>
        </tr>
        </tbody>
      </table>
    </div>

    <!-- Lista Completa de Produtos -->
    <div class="todos-produtos-section">
      <div class="section-header">
        <h3>üì¶ Todos os Produtos ({{ produtosFiltrados.length }})</h3>
        <div class="filtro-info" *ngIf="filtroAtivo">
          <small>Filtros ativos: {{ filtroCategoria || 'Todas categorias' }} | {{ filtroDataInicio ? (filtroDataInicio + ' a ' + filtroDataFim) : 'Todo per√≠odo' }}</small>
        </div>
      </div>

      <table class="tabela-produtos">
        <thead>
        <tr>
          <th (click)="ordenarPor('codigo')" class="ordenavel">
            C√≥digo {{ colunaOrdenada === 'codigo' ? (ordemAscendente ? '‚Üë' : '‚Üì') : '' }}
          </th>
          <th (click)="ordenarPor('nome')" class="ordenavel">
            Nome {{ colunaOrdenada === 'nome' ? (ordemAscendente ? '‚Üë' : '‚Üì') : '' }}
          </th>
          <th (click)="ordenarPor('quantidadeEstoque')" class="ordenavel">
            Estoque {{ colunaOrdenada === 'quantidadeEstoque' ? (ordemAscendente ? '‚Üë' : '‚Üì') : '' }}
          </th>
          <th (click)="ordenarPor('precoUnitario')" class="ordenavel">
            Pre√ßo Unit. {{ colunaOrdenada === 'precoUnitario' ? (ordemAscendente ? '‚Üë' : '‚Üì') : '' }}
          </th>
          <th>Valor Total</th>
          <th (click)="ordenarPor('categoria')" class="ordenavel">
            Categoria {{ colunaOrdenada === 'categoria' ? (ordemAscendente ? '‚Üë' : '‚Üì') : '' }}
          </th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let produto of produtosFiltrados"
            [class.estoque-baixo]="(produto.quantidadeEstoque || 0) < 10">
          <td>{{ produto.codigo }}</td>
          <td>{{ produto.nome }}</td>
          <td>{{ produto.quantidadeEstoque || 0 }}</td>
          <td>R$ {{ (produto.precoUnitario || 0).toFixed(2) }}</td>
          <td><strong>R$ {{ ((produto.precoUnitario || 0) * (produto.quantidadeEstoque || 0)).toFixed(2) }}</strong></td>
          <td><span class="categoria-badge">{{ produto.categoria }}</span></td>
        </tr>
        </tbody>
      </table>
    </div>

    <!-- Bot√µes de A√ß√£o -->
    <div class="acoes-relatorio">
      <button class="btn-exportar" (click)="exportarRelatorio()">
        üì• Exportar Relat√≥rio JSON
      </button>
      <button class="btn-dashboard" routerLink="/dashboard">
        üìà Ver Dashboard Completo
      </button>
    </div>
  </div>

  <button class="btn-voltar" routerLink="/">‚Üê Voltar para Home</button>
</div>
